
<!DOCTYPE html>
<html>
<head>
<style type="text/css">
.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.left {
  text-align: left;
}
.right {
  text-align: right;
}
.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
  <script src="https://yihui.name/media/js/center-images.js"></script>
  <title>A Report Generated by knitr</title>
</head>
<body>

  <p>This report is automatically generated with the R
    package <a href="https://yihui.name/knitr/"><strong>knitr</strong></a>
    (version <code class="knitr inline">1.42</code>)
    .</p>


<div class="chunk" id="unnamed-chunk-2"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(FLCore)</span>
<span class="hl kwd">library</span><span class="hl std">(FLEDA)</span>
<span class="hl kwd">library</span><span class="hl std">(gridExtra)</span>
<span class="hl kwd">library</span><span class="hl std">(dplyr)</span>
<span class="hl kwd">library</span><span class="hl std">(tidyr)</span>
<span class="hl kwd">library</span><span class="hl std">(ggridges)</span>

<span class="hl kwd">mkdir</span><span class="hl std">(</span><span class="hl str">&quot;data&quot;</span><span class="hl std">)</span>

<span class="hl com"># load index and stock</span>
<span class="hl kwd">load</span><span class="hl std">(</span><span class="hl kwd">taf.data.path</span><span class="hl std">(</span><span class="hl str">&quot;stock&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;meg78_stock.RData&quot;</span><span class="hl std">))</span>
<span class="hl kwd">load</span><span class="hl std">(</span><span class="hl kwd">taf.data.path</span><span class="hl std">(</span><span class="hl str">&quot;indices&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;meg78_indices.RData&quot;</span><span class="hl std">))</span>

<span class="hl com"># utilities</span>
<span class="hl std">SavePlot</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">plotname</span><span class="hl std">,</span> <span class="hl kwc">width</span> <span class="hl std">=</span> <span class="hl num">10</span><span class="hl std">,</span> <span class="hl kwc">height</span> <span class="hl std">=</span> <span class="hl num">7</span><span class="hl std">) {</span>
  <span class="hl std">file</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">file.path</span><span class="hl std">(</span><span class="hl str">&quot;data&quot;</span><span class="hl std">,</span> <span class="hl kwd">paste0</span><span class="hl std">(</span><span class="hl str">&quot;meg78_data_&quot;</span><span class="hl std">, plotname,</span> <span class="hl str">&quot;.png&quot;</span><span class="hl std">))</span>
  <span class="hl kwd">dev.print</span><span class="hl std">(png, file,</span> <span class="hl kwc">width</span> <span class="hl std">= width,</span> <span class="hl kwc">height</span> <span class="hl std">= height,</span> <span class="hl kwc">units</span> <span class="hl std">=</span> <span class="hl str">&quot;in&quot;</span><span class="hl std">,</span> <span class="hl kwc">res</span> <span class="hl std">=</span> <span class="hl num">300</span><span class="hl std">)</span>
<span class="hl std">}</span>
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-3"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">ages</span> <span class="hl kwb">&lt;-</span> <span class="hl std">stock</span><span class="hl opt">@</span><span class="hl kwc">range</span><span class="hl std">[</span><span class="hl str">&quot;min&quot;</span><span class="hl std">]</span><span class="hl opt">:</span><span class="hl std">stock</span><span class="hl opt">@</span><span class="hl kwc">range</span><span class="hl std">[</span><span class="hl str">&quot;max&quot;</span><span class="hl std">]</span>
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-4"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">stock</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">setPlusGroup</span><span class="hl std">(stock,</span> <span class="hl num">10</span><span class="hl std">)</span>
<span class="hl kwd">sum</span><span class="hl std">(stock</span><span class="hl opt">@</span><span class="hl kwc">catch.n</span> <span class="hl opt">==</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">na.rm</span> <span class="hl std">= T)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">stock</span><span class="hl opt">@</span><span class="hl kwc">catch.n</span><span class="hl std">[stock</span><span class="hl opt">@</span><span class="hl kwc">catch.n</span> <span class="hl opt">==</span> <span class="hl num">0</span><span class="hl std">]</span> <span class="hl kwb">&lt;-</span> <span class="hl num">NA</span>
<span class="hl std">tun.sel</span>
</pre></div>
<div class="output"><pre class="knitr r">## An object of class &quot;FLIndices&quot;
## [[1]]
## An object of class &quot;FLIndex&quot;
## 
## Name: FR_EVHOE 
## Description: French IBTS survey index in 7 and 8abd; Catch in numbers per hour;L. whiffiagonnis 
## Type :  numbers 
## Distribution :   
## Quant: age 
## Dims:  age 	year	unit	season	area	iter
## 	5	26	1	1	1	1	
## 
## Range:  min	max	pgroup	minyear	maxyear	startf	endf 
## 	1	5	5	1997	2022	0.75	1	
## 
## 
## [[2]]
## An object of class &quot;FLIndex&quot;
## 
## Name: SP_PORC 
## Description: Spanish IBTS Porcupine survey; Cpue in numbers per 30min; L. whiffiagonnis 
## Type :  numbers 
## Distribution :   
## Quant: age 
## Dims:  age 	year	unit	season	area	iter
## 	8	22	1	1	1	1	
## 
## Range:  min	max	pgroup	minyear	maxyear	startf	endf 
## 	1	8	8	2001	2022	0.5	0.75	
## 
## 
## [[3]]
## An object of class &quot;FLIndex&quot;
## 
## Name: CPUE.IAM 
## Description: Irish Anglerfish and Megrim Survey in Q1 since 2016; unit Standardised to N*1000/hou [...] 
## Type :  numbers 
## Distribution :   
## Quant: age 
## Dims:  age 	year	unit	season	area	iter
## 	8	7	1	1	1	1	
## 
## Range:  min	max	pgroup	minyear	maxyear	startf	endf 
## 	3	10	10	2016	2022	0	0.25	
## 
## 
## [[4]]
## An object of class &quot;FLIndex&quot;
## 
## Name: CPUE.IRLFRsurvey 
## Description: Combined Irish and French IBTS survey Q4 ; unit Standardised to N*1000/hour; L. whif [...] 
## Type :  numbers 
## Distribution :   
## Quant: age 
## Dims:  age 	year	unit	season	area	iter
## 	10	20	1	1	1	1	
## 
## Range:  min	max	pgroup	minyear	maxyear	startf	endf 
## 	1	10	10	2003	2022	0.75	1	
## 
## 
## [[5]]
## An object of class &quot;FLIndex&quot;
## 
## Name: CPUE.Vigo84 
## Description: Spanish demersal trawlers (Vigo) in subarea 7 from 1984-1998; L. whiffiagonnis 
## Type :  numbers 
## Distribution :   
## Quant: age 
## Dims:  age 	year	unit	season	area	iter
## 	8	15	1	1	1	1	
## 
## Range:  min	max	pgroup	minyear	maxyear	startf	endf 
## 	2	9	9	1984	1998	0	1	
## 
## 
## [[6]]
## An object of class &quot;FLIndex&quot;
## 
## Name: CPUE.Vigo99 
## Description: Spanish demersal trawlers (Vigo) in subarea 7 from 1999-2019; L. whiffiagonnis 
## Type :  numbers 
## Distribution :   
## Quant: age 
## Dims:  age 	year	unit	season	area	iter
## 	10	21	1	1	1	1	
## 
## Range:  min	max	pgroup	minyear	maxyear	startf	endf 
## 	1	10	10	1999	2019	0	1	
## 
## 
## [[7]]
## An object of class &quot;FLIndex&quot;
## 
## Name: LPUE.IRTBB 
## Description: Irish beam trawlers; unit Standardised to N0/10SqKm; L. whiffiagonnis 
## Type :  numbers 
## Distribution :   
## Quant: age 
## Dims:  age 	year	unit	season	area	iter
## 	6	26	1	1	1	1	
## 
## Range:  min	max	pgroup	minyear	maxyear	startf	endf 
## 	2	7	7	1995	2020	0	1	
## 
## 
## [[8]]
## An object of class &quot;FLIndexBiomass&quot;
## 
## Name: CPUE.VIGOSAMP 
## Description: Vigo Standardized CPUE from sampling data; unit Standardised to kg/hour; L. whiffiagonnis 
## Distribution :   
## Quant: age 
## Dims:  age 	year	unit	season	area	iter
## 	1	33	1	1	1	1	
## 
## Range:  min	max	pgroup	minyear	maxyear	startf	endf 
## 	NA	NA	NA	1988	2020	0	1	
## 
## 
## Slot &quot;names&quot;:
## [1] &quot;FR_EVHOE&quot;         &quot;SP_PORC&quot;          &quot;CPUE.IAM&quot;         &quot;CPUE.IRLFRsurvey&quot;
## [5] &quot;CPUE.Vigo84&quot;      &quot;CPUE.Vigo99&quot;      &quot;LPUE.IRTBB&quot;       &quot;CPUE.VIGOSAMP&quot;   
## 
## Slot &quot;desc&quot;:
## character(0)
## 
## Slot &quot;lock&quot;:
## [1] FALSE
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">with</span><span class="hl std">(</span><span class="hl kwd">subset</span><span class="hl std">(</span><span class="hl kwd">as.data.frame</span><span class="hl std">(stock</span><span class="hl opt">@</span><span class="hl kwc">catch.n</span><span class="hl std">),</span> <span class="hl opt">!</span><span class="hl kwd">is.na</span><span class="hl std">(data)</span> <span class="hl opt">&amp;</span> <span class="hl std">data</span> <span class="hl opt">&gt;</span> <span class="hl num">0</span><span class="hl std">),</span> <span class="hl kwd">plot</span><span class="hl std">(year, age</span> <span class="hl opt">-</span> <span class="hl num">0.3</span><span class="hl std">,</span> <span class="hl kwc">pch</span> <span class="hl std">=</span> <span class="hl str">&quot;-&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl num">4</span><span class="hl std">,</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">4</span><span class="hl std">,</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">10.5</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">),</span> <span class="hl kwc">yaxs</span> <span class="hl std">=</span> <span class="hl str">&quot;i&quot;</span><span class="hl std">,</span> <span class="hl kwc">lab</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">8</span><span class="hl std">,</span> <span class="hl num">8</span><span class="hl std">,</span> <span class="hl num">7</span><span class="hl std">),</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;age&quot;</span><span class="hl std">,</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Data used in the assessment&quot;</span><span class="hl std">))</span>
<span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">0.5</span><span class="hl opt">:</span><span class="hl num">6.5</span><span class="hl std">)</span> <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span> <span class="hl std">= i,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;grey&quot;</span><span class="hl std">)</span>
<span class="hl kwd">with</span><span class="hl std">(</span><span class="hl kwd">subset</span><span class="hl std">(</span><span class="hl kwd">as.data.frame</span><span class="hl std">(tun.sel[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">@</span><span class="hl kwc">index</span><span class="hl std">),</span> <span class="hl opt">!</span><span class="hl kwd">is.na</span><span class="hl std">(data)),</span> <span class="hl kwd">points</span><span class="hl std">(year, age</span> <span class="hl opt">-</span> <span class="hl num">0.1</span><span class="hl std">,</span> <span class="hl kwc">pch</span> <span class="hl std">=</span> <span class="hl str">&quot;-&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl num">5</span><span class="hl std">,</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">4</span><span class="hl std">))</span>
<span class="hl kwd">with</span><span class="hl std">(</span><span class="hl kwd">subset</span><span class="hl std">(</span><span class="hl kwd">as.data.frame</span><span class="hl std">(tun.sel[[</span><span class="hl num">2</span><span class="hl std">]]</span><span class="hl opt">@</span><span class="hl kwc">index</span><span class="hl std">),</span> <span class="hl opt">!</span><span class="hl kwd">is.na</span><span class="hl std">(data)),</span> <span class="hl kwd">points</span><span class="hl std">(year, age</span> <span class="hl opt">+</span> <span class="hl num">0.1</span><span class="hl std">,</span> <span class="hl kwc">pch</span> <span class="hl std">=</span> <span class="hl str">&quot;-&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">4</span><span class="hl std">))</span>
<span class="hl kwd">with</span><span class="hl std">(</span><span class="hl kwd">subset</span><span class="hl std">(</span><span class="hl kwd">as.data.frame</span><span class="hl std">(tun.sel[[</span><span class="hl num">3</span><span class="hl std">]]</span><span class="hl opt">@</span><span class="hl kwc">index</span><span class="hl std">),</span> <span class="hl opt">!</span><span class="hl kwd">is.na</span><span class="hl std">(data)),</span> <span class="hl kwd">points</span><span class="hl std">(year, age</span> <span class="hl opt">+</span> <span class="hl num">0.3</span><span class="hl std">,</span> <span class="hl kwc">pch</span> <span class="hl std">=</span> <span class="hl str">&quot;-&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl num">6</span><span class="hl std">,</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">4</span><span class="hl std">))</span>
<span class="hl kwd">with</span><span class="hl std">(</span><span class="hl kwd">subset</span><span class="hl std">(</span><span class="hl kwd">as.data.frame</span><span class="hl std">(tun.sel[[</span><span class="hl num">4</span><span class="hl std">]]</span><span class="hl opt">@</span><span class="hl kwc">index</span><span class="hl std">),</span> <span class="hl opt">!</span><span class="hl kwd">is.na</span><span class="hl std">(data)),</span> <span class="hl kwd">points</span><span class="hl std">(year, age</span> <span class="hl opt">+</span> <span class="hl num">0.3</span><span class="hl std">,</span> <span class="hl kwc">pch</span> <span class="hl std">=</span> <span class="hl str">&quot;-&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl num">7</span><span class="hl std">,</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">4</span><span class="hl std">))</span>
<span class="hl kwd">with</span><span class="hl std">(</span><span class="hl kwd">subset</span><span class="hl std">(</span><span class="hl kwd">as.data.frame</span><span class="hl std">(tun.sel[[</span><span class="hl num">5</span><span class="hl std">]]</span><span class="hl opt">@</span><span class="hl kwc">index</span><span class="hl std">),</span> <span class="hl opt">!</span><span class="hl kwd">is.na</span><span class="hl std">(data)),</span> <span class="hl kwd">points</span><span class="hl std">(year, age</span> <span class="hl opt">+</span> <span class="hl num">0.3</span><span class="hl std">,</span> <span class="hl kwc">pch</span> <span class="hl std">=</span> <span class="hl str">&quot;-&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl num">8</span><span class="hl std">,</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">4</span><span class="hl std">))</span>
<span class="hl kwd">legend</span><span class="hl std">(</span><span class="hl str">&quot;topleft&quot;</span><span class="hl std">,</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Catch nos&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;FR_EVHOE&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;SP_PORC&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;CPUE.Vigo84&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;CPUE.Vigo99&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;LPUE.ITBB&quot;</span><span class="hl std">),</span> <span class="hl kwc">pch</span> <span class="hl std">=</span> <span class="hl str">&quot;-&quot;</span><span class="hl std">,</span> <span class="hl kwc">pt.cex</span> <span class="hl std">=</span> <span class="hl num">4</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">4</span><span class="hl std">,</span> <span class="hl num">5</span><span class="hl std">,</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl num">6</span><span class="hl std">,</span> <span class="hl num">7</span><span class="hl std">,</span> <span class="hl num">8</span><span class="hl std">),</span> <span class="hl kwc">ncol</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;DataAvailability&quot;</span><span class="hl std">,</span> <span class="hl num">10</span><span class="hl std">,</span> <span class="hl num">5</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-5"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">mfrow</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl num">2</span><span class="hl std">))</span>
<span class="hl kwd">with</span><span class="hl std">(</span><span class="hl kwd">as.data.frame</span><span class="hl std">(stock</span><span class="hl opt">@</span><span class="hl kwc">catch.n</span><span class="hl std">),</span> <span class="hl kwd">plot</span><span class="hl std">(age,</span> <span class="hl kwd">log</span><span class="hl std">(data),</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;catch.n&quot;</span><span class="hl std">))</span>
<span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">5</span><span class="hl std">)</span> <span class="hl kwd">with</span><span class="hl std">(</span><span class="hl kwd">as.data.frame</span><span class="hl std">(tun.sel[[i]]</span><span class="hl opt">@</span><span class="hl kwc">index</span><span class="hl std">),</span> <span class="hl kwd">plot</span><span class="hl std">(age,</span> <span class="hl kwd">log</span><span class="hl std">(data),</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl kwd">name</span><span class="hl std">(tun.sel[[i]])))</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;LogNumbersAtAgeDistribution&quot;</span><span class="hl std">,</span> <span class="hl num">10</span><span class="hl std">,</span> <span class="hl num">10</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-5-2.png" alt="plot of chunk unnamed-chunk-5" class="plot" /></div></div>
<div class="chunk" id="unnamed-chunk-6"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">fun</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">,</span> <span class="hl kwc">digits</span> <span class="hl std">=</span> <span class="hl num">0</span><span class="hl std">)</span> <span class="hl kwd">with</span><span class="hl std">(</span><span class="hl kwd">as.data.frame</span><span class="hl std">(x),</span> <span class="hl kwd">tapply</span><span class="hl std">(</span><span class="hl kwd">round</span><span class="hl std">(data, digits),</span> <span class="hl kwd">list</span><span class="hl std">(year, age), sum))</span>
<span class="hl std">filename</span> <span class="hl kwb">&lt;-</span> <span class="hl str">&quot;data/Meg78_Input.csv&quot;</span>
<span class="hl kwd">write.table</span><span class="hl std">(</span><span class="hl str">&quot;meg78abd input data&quot;</span><span class="hl std">, filename,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">,</span> <span class="hl kwc">quote</span> <span class="hl std">= F,</span> <span class="hl kwc">row.names</span> <span class="hl std">= F,</span> <span class="hl kwc">col.names</span> <span class="hl std">= F)</span>
<span class="hl kwd">write.table</span><span class="hl std">(</span><span class="hl str">&quot;\ncatch.n&quot;</span><span class="hl std">, filename,</span> <span class="hl kwc">append</span> <span class="hl std">= T,</span> <span class="hl kwc">quote</span> <span class="hl std">= F,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">,</span> <span class="hl kwc">row.names</span> <span class="hl std">= F,</span> <span class="hl kwc">col.names</span> <span class="hl std">= F,</span> <span class="hl kwc">eol</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">)</span>
<span class="hl kwd">write.table</span><span class="hl std">(</span><span class="hl kwd">fun</span><span class="hl std">(</span><span class="hl kwd">catch.n</span><span class="hl std">(stock)), filename,</span> <span class="hl kwc">append</span> <span class="hl std">= T,</span> <span class="hl kwc">quote</span> <span class="hl std">= F,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">,</span> <span class="hl kwc">na</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">,</span> <span class="hl kwc">row.names</span> <span class="hl std">= T,</span> <span class="hl kwc">col.names</span> <span class="hl std">= T)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning in write.table(fun(catch.n(stock)), filename, append = T, quote = F, : appending
## column names to file
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">write.table</span><span class="hl std">(</span><span class="hl str">&quot;\nprop.dis&quot;</span><span class="hl std">, filename,</span> <span class="hl kwc">append</span> <span class="hl std">= T,</span> <span class="hl kwc">quote</span> <span class="hl std">= F,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">,</span> <span class="hl kwc">row.names</span> <span class="hl std">= F,</span> <span class="hl kwc">col.names</span> <span class="hl std">= F,</span> <span class="hl kwc">eol</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">)</span>
<span class="hl kwd">write.table</span><span class="hl std">(</span><span class="hl kwd">fun</span><span class="hl std">(</span><span class="hl kwd">discards.n</span><span class="hl std">(stock)</span> <span class="hl opt">/</span> <span class="hl kwd">catch.n</span><span class="hl std">(stock),</span> <span class="hl num">5</span><span class="hl std">), filename,</span> <span class="hl kwc">append</span> <span class="hl std">= T,</span> <span class="hl kwc">quote</span> <span class="hl std">= F,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">,</span> <span class="hl kwc">na</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">,</span> <span class="hl kwc">row.names</span> <span class="hl std">= T,</span> <span class="hl kwc">col.names</span> <span class="hl std">= T)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning in write.table(fun(discards.n(stock)/catch.n(stock), 5), filename, : appending
## column names to file
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">write.table</span><span class="hl std">(</span><span class="hl str">&quot;\ncatch.wt&quot;</span><span class="hl std">, filename,</span> <span class="hl kwc">append</span> <span class="hl std">= T,</span> <span class="hl kwc">quote</span> <span class="hl std">= F,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">,</span> <span class="hl kwc">row.names</span> <span class="hl std">= F,</span> <span class="hl kwc">col.names</span> <span class="hl std">= F,</span> <span class="hl kwc">eol</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">)</span>
<span class="hl kwd">write.table</span><span class="hl std">(</span><span class="hl kwd">fun</span><span class="hl std">(</span><span class="hl kwd">catch.wt</span><span class="hl std">(stock),</span> <span class="hl num">3</span><span class="hl std">), filename,</span> <span class="hl kwc">append</span> <span class="hl std">= T,</span> <span class="hl kwc">quote</span> <span class="hl std">= F,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">,</span> <span class="hl kwc">na</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">,</span> <span class="hl kwc">row.names</span> <span class="hl std">= T,</span> <span class="hl kwc">col.names</span> <span class="hl std">= T)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning in write.table(fun(catch.wt(stock), 3), filename, append = T, quote = F, :
## appending column names to file
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">write.table</span><span class="hl std">(</span><span class="hl str">&quot;\nstock.wt&quot;</span><span class="hl std">, filename,</span> <span class="hl kwc">append</span> <span class="hl std">= T,</span> <span class="hl kwc">quote</span> <span class="hl std">= F,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">,</span> <span class="hl kwc">row.names</span> <span class="hl std">= F,</span> <span class="hl kwc">col.names</span> <span class="hl std">= F,</span> <span class="hl kwc">eol</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">)</span>
<span class="hl kwd">write.table</span><span class="hl std">(</span><span class="hl kwd">fun</span><span class="hl std">(</span><span class="hl kwd">stock.wt</span><span class="hl std">(stock),</span> <span class="hl num">3</span><span class="hl std">), filename,</span> <span class="hl kwc">append</span> <span class="hl std">= T,</span> <span class="hl kwc">quote</span> <span class="hl std">= F,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">,</span> <span class="hl kwc">na</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">,</span> <span class="hl kwc">row.names</span> <span class="hl std">= T,</span> <span class="hl kwc">col.names</span> <span class="hl std">= T)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning in write.table(fun(stock.wt(stock), 3), filename, append = T, quote = F, :
## appending column names to file
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">5</span><span class="hl std">) {</span>
  <span class="hl kwd">write.table</span><span class="hl std">(</span><span class="hl kwd">paste0</span><span class="hl std">(</span><span class="hl str">&quot;\n&quot;</span><span class="hl std">,</span> <span class="hl kwd">name</span><span class="hl std">(tun.sel[[i]])), filename,</span> <span class="hl kwc">append</span> <span class="hl std">= T,</span> <span class="hl kwc">quote</span> <span class="hl std">= F,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">,</span> <span class="hl kwc">row.names</span> <span class="hl std">= F,</span> <span class="hl kwc">col.names</span> <span class="hl std">= F,</span> <span class="hl kwc">eol</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">write.table</span><span class="hl std">(</span><span class="hl kwd">fun</span><span class="hl std">(</span><span class="hl kwd">index</span><span class="hl std">(tun.sel[[i]]),</span> <span class="hl num">3</span><span class="hl std">), filename,</span> <span class="hl kwc">append</span> <span class="hl std">= T,</span> <span class="hl kwc">quote</span> <span class="hl std">= F,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">,</span> <span class="hl kwc">na</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">,</span> <span class="hl kwc">row.names</span> <span class="hl std">= T,</span> <span class="hl kwc">col.names</span> <span class="hl std">= T)</span>
<span class="hl std">}</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning in write.table(fun(index(tun.sel[[i]]), 3), filename, append = T, : appending
## column names to file
</pre></div>
<div class="warning"><pre class="knitr r">## Warning in write.table(fun(index(tun.sel[[i]]), 3), filename, append = T, : appending
## column names to file

## Warning in write.table(fun(index(tun.sel[[i]]), 3), filename, append = T, : appending
## column names to file

## Warning in write.table(fun(index(tun.sel[[i]]), 3), filename, append = T, : appending
## column names to file

## Warning in write.table(fun(index(tun.sel[[i]]), 3), filename, append = T, : appending
## column names to file
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-7"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">LA</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.data.frame</span><span class="hl std">(stock</span><span class="hl opt">@</span><span class="hl kwc">landings.n</span><span class="hl std">)</span>
<span class="hl std">DI</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.data.frame</span><span class="hl std">(stock</span><span class="hl opt">@</span><span class="hl kwc">discards.n</span><span class="hl std">)</span>
<span class="hl std">LA</span><span class="hl opt">$</span><span class="hl std">unit</span> <span class="hl kwb">&lt;-</span> <span class="hl str">&quot;1. landings&quot;</span>
<span class="hl std">DI</span><span class="hl opt">$</span><span class="hl std">unit</span> <span class="hl kwb">&lt;-</span> <span class="hl str">&quot;2. discards&quot;</span>

<span class="hl kwd">barchart</span><span class="hl std">(data</span> <span class="hl opt">/</span> <span class="hl num">1000</span> <span class="hl opt">~</span> <span class="hl kwd">as.factor</span><span class="hl std">(age)</span> <span class="hl opt">|</span> <span class="hl kwd">as.factor</span><span class="hl std">(year),</span> <span class="hl kwc">groups</span> <span class="hl std">= unit,</span> <span class="hl kwc">data</span> <span class="hl std">=</span> <span class="hl kwd">na.omit</span><span class="hl std">(</span><span class="hl kwd">rbind</span><span class="hl std">(LA, DI)),</span> <span class="hl kwc">stack</span> <span class="hl std">= T,</span> <span class="hl kwc">as.table</span> <span class="hl std">= T,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Catch nos (millions)&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;grey&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;white&quot;</span><span class="hl std">),</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;age&quot;</span><span class="hl std">,</span> <span class="hl kwc">par.strip.text</span> <span class="hl std">=</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">0.8</span><span class="hl std">))</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;cnna1&quot;</span><span class="hl std">,</span> <span class="hl num">10</span><span class="hl std">,</span> <span class="hl num">5</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">LA</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.data.frame</span><span class="hl std">(stock</span><span class="hl opt">@</span><span class="hl kwc">landings.n</span> <span class="hl opt">*</span> <span class="hl std">stock</span><span class="hl opt">@</span><span class="hl kwc">landings.wt</span><span class="hl std">)</span>
<span class="hl std">DI</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.data.frame</span><span class="hl std">(stock</span><span class="hl opt">@</span><span class="hl kwc">discards.n</span> <span class="hl opt">*</span> <span class="hl std">stock</span><span class="hl opt">@</span><span class="hl kwc">discards.wt</span><span class="hl std">)</span>
<span class="hl std">LA</span><span class="hl opt">$</span><span class="hl std">unit</span> <span class="hl kwb">&lt;-</span> <span class="hl str">&quot;1. landings&quot;</span>
<span class="hl std">DI</span><span class="hl opt">$</span><span class="hl std">unit</span> <span class="hl kwb">&lt;-</span> <span class="hl str">&quot;2. discards&quot;</span>
<span class="hl kwd">barchart</span><span class="hl std">(data</span> <span class="hl opt">/</span> <span class="hl num">1000</span> <span class="hl opt">~</span> <span class="hl kwd">as.factor</span><span class="hl std">(age)</span> <span class="hl opt">|</span> <span class="hl kwd">as.factor</span><span class="hl std">(year),</span> <span class="hl kwc">groups</span> <span class="hl std">= unit,</span> <span class="hl kwc">data</span> <span class="hl std">=</span> <span class="hl kwd">na.omit</span><span class="hl std">(</span><span class="hl kwd">rbind</span><span class="hl std">(LA, DI)),</span> <span class="hl kwc">stack</span> <span class="hl std">= T,</span> <span class="hl kwc">as.table</span> <span class="hl std">= T,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Catch wts (kT)&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;grey&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;white&quot;</span><span class="hl std">),</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;age&quot;</span><span class="hl std">,</span> <span class="hl kwc">par.strip.text</span> <span class="hl std">=</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">0.8</span><span class="hl std">))</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-7-2.png" alt="plot of chunk unnamed-chunk-7" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;cnaa2&quot;</span><span class="hl std">,</span> <span class="hl num">10</span><span class="hl std">,</span> <span class="hl num">5</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-8"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">pfun</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">,</span> <span class="hl kwc">y</span><span class="hl std">,</span> <span class="hl kwc">groups</span><span class="hl std">,</span> <span class="hl kwc">subscripts</span><span class="hl std">,</span> <span class="hl kwc">...</span><span class="hl std">) {</span>
  <span class="hl kwd">panel.superpose</span><span class="hl std">(x, y, subscripts,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">groups</span> <span class="hl std">= groups,</span> <span class="hl kwc">lwd</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">, ...)</span>
  <span class="hl kwd">lpoints</span><span class="hl std">(x, y,</span> <span class="hl kwc">pch</span> <span class="hl std">=</span> <span class="hl num">16</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;white&quot;</span><span class="hl std">,</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">1.25</span><span class="hl std">)</span>
  <span class="hl kwd">ltext</span><span class="hl std">(x, y, groups,</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">0.6</span><span class="hl std">)</span>
<span class="hl std">}</span>
<span class="hl std">a</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">xyplot</span><span class="hl std">(data</span> <span class="hl opt">~</span> <span class="hl std">year,</span> <span class="hl kwc">groups</span> <span class="hl std">= age, stock</span><span class="hl opt">@</span><span class="hl kwc">discards.n</span> <span class="hl opt">/</span> <span class="hl std">stock</span><span class="hl opt">@</span><span class="hl kwc">catch.n</span><span class="hl std">,</span> <span class="hl kwc">panel</span> <span class="hl std">= pfun,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Proportion discarded&quot;</span><span class="hl std">,</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Discards&quot;</span><span class="hl std">)</span>
<span class="hl std">b</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">xyplot</span><span class="hl std">(data</span> <span class="hl opt">~</span> <span class="hl std">age,</span> <span class="hl kwc">groups</span> <span class="hl std">= year, stock</span><span class="hl opt">@</span><span class="hl kwc">discards.n</span> <span class="hl opt">/</span> <span class="hl std">stock</span><span class="hl opt">@</span><span class="hl kwc">catch.n</span><span class="hl std">,</span> <span class="hl kwc">panel</span> <span class="hl std">= pfun,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Proportion discarded&quot;</span><span class="hl std">,</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Discards&quot;</span><span class="hl std">)</span>
<span class="hl kwd">grid.arrange</span><span class="hl std">(a, b,</span> <span class="hl kwc">ncol</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;pdis&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-9"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">a</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">xyplot</span><span class="hl std">(data</span> <span class="hl opt">~</span> <span class="hl std">year,</span> <span class="hl kwc">groups</span> <span class="hl std">= age, stock</span><span class="hl opt">@</span><span class="hl kwc">stock.wt</span><span class="hl std">,</span> <span class="hl kwc">panel</span> <span class="hl std">= pfun,</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">1.2</span><span class="hl std">),</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Mean weight at age (kg)&quot;</span><span class="hl std">,</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Stock weights&quot;</span><span class="hl std">)</span>
<span class="hl std">b</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">xyplot</span><span class="hl std">(data</span> <span class="hl opt">~</span> <span class="hl std">year,</span> <span class="hl kwc">groups</span> <span class="hl std">= age, stock</span><span class="hl opt">@</span><span class="hl kwc">catch.wt</span><span class="hl std">,</span> <span class="hl kwc">panel</span> <span class="hl std">= pfun,</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">1.2</span><span class="hl std">),</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Mean weight at age (kg)&quot;</span><span class="hl std">,</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Catch weights&quot;</span><span class="hl std">)</span>
<span class="hl kwd">grid.arrange</span><span class="hl std">(a, b,</span> <span class="hl kwc">ncol</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># b</span>
<span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;cwaa&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-10"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">a</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">catch.n</span><span class="hl std">(stock)</span>
<span class="hl std">a[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwd">as.character</span><span class="hl std">(</span><span class="hl num">1986</span><span class="hl opt">:</span><span class="hl num">2002</span><span class="hl std">)]</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">apply</span><span class="hl std">(</span><span class="hl kwd">window</span><span class="hl std">(a,</span> <span class="hl kwc">start</span> <span class="hl std">=</span> <span class="hl num">2003</span><span class="hl std">),</span> <span class="hl num">1</span><span class="hl std">, mean)[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">2</span><span class="hl std">, ]</span>
<span class="hl std">b</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">spay</span><span class="hl std">(a)</span>
<span class="hl std">b[</span><span class="hl kwd">is.na</span><span class="hl std">(b)]</span> <span class="hl kwb">&lt;-</span> <span class="hl num">0</span>
<span class="hl std">b[</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwd">as.character</span><span class="hl std">(</span><span class="hl num">1986</span><span class="hl opt">:</span><span class="hl num">2002</span><span class="hl std">)]</span> <span class="hl kwb">&lt;-</span> <span class="hl num">0</span>
<span class="hl kwd">bubbles</span><span class="hl std">(age</span> <span class="hl opt">~</span> <span class="hl std">year, b,</span> <span class="hl kwc">bub.scale</span> <span class="hl std">=</span> <span class="hl num">5</span><span class="hl std">,</span> <span class="hl kwc">bub.col</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;#00000050&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;#FFFFFF50&quot;</span><span class="hl std">),</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Catch&quot;</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;bubbles3&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-11"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">a</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ccplot</span><span class="hl std">(data</span> <span class="hl opt">~</span> <span class="hl std">age,</span> <span class="hl kwd">logcc</span><span class="hl std">(</span><span class="hl kwd">catch.n</span><span class="hl std">(stock)),</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;b&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;#00000050&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;log ratio&quot;</span><span class="hl std">,</span> <span class="hl kwc">pch</span> <span class="hl std">=</span> <span class="hl num">16</span><span class="hl std">,</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">0.5</span><span class="hl std">)</span>
<span class="hl std">x1</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">logcc</span><span class="hl std">(</span><span class="hl kwd">catch.n</span><span class="hl std">(stock))</span>
<span class="hl std">x2</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">FLCohort</span><span class="hl std">(</span><span class="hl kwd">catch.n</span><span class="hl std">(stock))</span>
<span class="hl std">x3</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">apply</span><span class="hl std">(x1</span> <span class="hl opt">*</span> <span class="hl std">x2[</span><span class="hl kwd">rownames</span><span class="hl std">(x1),</span> <span class="hl kwd">colnames</span><span class="hl std">(x1), ],</span> <span class="hl num">1</span><span class="hl std">, mean,</span> <span class="hl kwc">na.rm</span> <span class="hl std">= T)</span>
<span class="hl std">x4</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">apply</span><span class="hl std">(x2[</span><span class="hl kwd">rownames</span><span class="hl std">(x1),</span> <span class="hl kwd">colnames</span><span class="hl std">(x1), ],</span> <span class="hl num">1</span><span class="hl std">, mean,</span> <span class="hl kwc">na.rm</span> <span class="hl std">= T)</span>
<span class="hl com"># b &lt;- xyplot(x3/x4~ages[1:10],ylim=c(-1,1.75),type='b',ylab='weighted mean logratio')</span>
<span class="hl std">b</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ccplot</span><span class="hl std">(data</span> <span class="hl opt">~</span> <span class="hl std">year,</span> <span class="hl kwd">logcc</span><span class="hl std">(</span><span class="hl kwd">catch.n</span><span class="hl std">(stock)),</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;log ratio&quot;</span><span class="hl std">)</span>
<span class="hl kwd">grid.arrange</span><span class="hl std">(a, b,</span> <span class="hl kwc">ncol</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;logratio&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-12"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">xyplot</span><span class="hl std">(</span><span class="hl kwd">log</span><span class="hl std">(data)</span> <span class="hl opt">~</span> <span class="hl std">year,</span> <span class="hl kwc">groups</span> <span class="hl std">= year</span> <span class="hl opt">-</span> <span class="hl std">age,</span> <span class="hl kwc">data</span> <span class="hl std">= stock</span><span class="hl opt">@</span><span class="hl kwc">catch.n</span><span class="hl std">,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;log indices&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;cc&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-13"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">a</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">xyplot</span><span class="hl std">(data</span> <span class="hl opt">~</span> <span class="hl std">year,</span> <span class="hl kwd">z</span><span class="hl std">(stock</span><span class="hl opt">@</span><span class="hl kwc">catch.n</span><span class="hl std">,</span> <span class="hl kwc">agerng</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl opt">:</span><span class="hl num">6</span><span class="hl std">)</span><span class="hl opt">@</span><span class="hl kwc">zy</span><span class="hl std">,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;mean Z age 3-6&quot;</span><span class="hl std">,</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Catch&quot;</span><span class="hl std">)</span>
<span class="hl std">x</span> <span class="hl kwb">&lt;-</span> <span class="hl std">stock</span><span class="hl opt">@</span><span class="hl kwc">catch.n</span>
<span class="hl std">x[x</span> <span class="hl opt">==</span> <span class="hl num">0</span><span class="hl std">]</span> <span class="hl kwb">&lt;-</span> <span class="hl num">1</span>
<span class="hl std">b</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">xyplot</span><span class="hl std">(data</span> <span class="hl opt">~</span> <span class="hl std">age,</span> <span class="hl kwd">z</span><span class="hl std">(x,</span> <span class="hl kwc">agerng</span> <span class="hl std">=</span> <span class="hl num">3</span><span class="hl opt">:</span><span class="hl num">6</span><span class="hl std">)</span><span class="hl opt">@</span><span class="hl kwc">za</span><span class="hl std">,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;mean Z&quot;</span><span class="hl std">,</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Catch&quot;</span><span class="hl std">)</span>
<span class="hl kwd">grid.arrange</span><span class="hl std">(a, b,</span> <span class="hl kwc">ncol</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" class="plot" /></div></div>
<div class="chunk" id="unnamed-chunk-14"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">x</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">trim</span><span class="hl std">(</span><span class="hl kwd">index</span><span class="hl std">(tun.sel[[</span><span class="hl num">1</span><span class="hl std">]]),</span> <span class="hl kwc">age</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">5</span><span class="hl std">)</span>
<span class="hl std">x[</span><span class="hl kwd">is.na</span><span class="hl std">(x)]</span> <span class="hl kwb">&lt;-</span> <span class="hl num">0</span>
<span class="hl std">sp</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">spay</span><span class="hl std">(x)</span>
<span class="hl std">sp[</span><span class="hl kwd">is.na</span><span class="hl std">(sp)]</span> <span class="hl kwb">&lt;-</span> <span class="hl num">0</span>
<span class="hl kwd">bubbles</span><span class="hl std">(age</span> <span class="hl opt">~</span> <span class="hl std">year, sp,</span> <span class="hl kwc">bub.scale</span> <span class="hl std">=</span> <span class="hl num">10</span><span class="hl std">,</span> <span class="hl kwc">bub.col</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;#00000050&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;#FFFFFF50&quot;</span><span class="hl std">),</span> <span class="hl kwc">main</span> <span class="hl std">= tun.sel[[</span><span class="hl num">1</span><span class="hl std">]]</span><span class="hl opt">@</span><span class="hl kwc">name</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;bubbles_tun_EVHOE&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-15"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">x</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">index</span><span class="hl std">(tun.sel[[</span><span class="hl num">2</span><span class="hl std">]])</span>
<span class="hl std">x[</span><span class="hl kwd">is.na</span><span class="hl std">(x)]</span> <span class="hl kwb">&lt;-</span> <span class="hl num">0</span>
<span class="hl std">sp</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">spay</span><span class="hl std">(x)</span>
<span class="hl std">sp[</span><span class="hl kwd">is.na</span><span class="hl std">(sp)]</span> <span class="hl kwb">&lt;-</span> <span class="hl num">0</span>
<span class="hl kwd">bubbles</span><span class="hl std">(age</span> <span class="hl opt">~</span> <span class="hl std">year, sp,</span> <span class="hl kwc">bub.scale</span> <span class="hl std">=</span> <span class="hl num">6</span><span class="hl std">,</span> <span class="hl kwc">bub.col</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;#00000050&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;#FFFFFF50&quot;</span><span class="hl std">),</span> <span class="hl kwc">main</span> <span class="hl std">= tun.sel[[</span><span class="hl num">2</span><span class="hl std">]]</span><span class="hl opt">@</span><span class="hl kwc">name</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-15-1.png" alt="plot of chunk unnamed-chunk-15" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;bubbles_tun_PORCU&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-16"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">x</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">index</span><span class="hl std">(tun.sel[[</span><span class="hl num">3</span><span class="hl std">]])</span>
<span class="hl std">x[</span><span class="hl kwd">is.na</span><span class="hl std">(x)]</span> <span class="hl kwb">&lt;-</span> <span class="hl num">0</span>
<span class="hl kwd">bubbles</span><span class="hl std">(age</span> <span class="hl opt">~</span> <span class="hl std">year,</span> <span class="hl kwd">spay</span><span class="hl std">(x),</span> <span class="hl kwc">bub.scale</span> <span class="hl std">=</span> <span class="hl num">10</span><span class="hl std">,</span> <span class="hl kwc">bub.col</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;#00000050&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;#FFFFFF50&quot;</span><span class="hl std">),</span> <span class="hl kwc">main</span> <span class="hl std">= tun.sel[[</span><span class="hl num">3</span><span class="hl std">]]</span><span class="hl opt">@</span><span class="hl kwc">name</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;bubbles_tun_vigo84&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-17"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">x</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">index</span><span class="hl std">(tun.sel[[</span><span class="hl num">4</span><span class="hl std">]])</span>
<span class="hl std">x[</span><span class="hl kwd">is.na</span><span class="hl std">(x)]</span> <span class="hl kwb">&lt;-</span> <span class="hl num">0</span>
<span class="hl kwd">bubbles</span><span class="hl std">(age</span> <span class="hl opt">~</span> <span class="hl std">year,</span> <span class="hl kwd">spay</span><span class="hl std">(x),</span> <span class="hl kwc">bub.scale</span> <span class="hl std">=</span> <span class="hl num">10</span><span class="hl std">,</span> <span class="hl kwc">bub.col</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;#00000050&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;#FFFFFF50&quot;</span><span class="hl std">),</span> <span class="hl kwc">main</span> <span class="hl std">= tun.sel[[</span><span class="hl num">4</span><span class="hl std">]]</span><span class="hl opt">@</span><span class="hl kwc">name</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-17-1.png" alt="plot of chunk unnamed-chunk-17" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;bubbles_tun_vigo99&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-18"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">x</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">index</span><span class="hl std">(tun.sel[[</span><span class="hl num">5</span><span class="hl std">]])</span>
<span class="hl std">x[</span><span class="hl kwd">is.na</span><span class="hl std">(x)]</span> <span class="hl kwb">&lt;-</span> <span class="hl num">0</span>
<span class="hl kwd">bubbles</span><span class="hl std">(age</span> <span class="hl opt">~</span> <span class="hl std">year,</span> <span class="hl kwd">spay</span><span class="hl std">(x),</span> <span class="hl kwc">bub.scale</span> <span class="hl std">=</span> <span class="hl num">10</span><span class="hl std">,</span> <span class="hl kwc">bub.col</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;#00000050&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;#FFFFFF50&quot;</span><span class="hl std">),</span> <span class="hl kwc">main</span> <span class="hl std">= tun.sel[[</span><span class="hl num">5</span><span class="hl std">]]</span><span class="hl opt">@</span><span class="hl kwc">name</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-18-1.png" alt="plot of chunk unnamed-chunk-18" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;bubbles_tun_IRTBB&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-19"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># temp function to standardise indices</span>
<span class="hl std">fun</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">) {</span>
  <span class="hl std">arr</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">apply</span><span class="hl std">(x</span><span class="hl opt">@</span><span class="hl kwc">.Data</span><span class="hl std">,</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl num">4</span><span class="hl std">,</span> <span class="hl num">5</span><span class="hl std">,</span> <span class="hl num">6</span><span class="hl std">), scale)</span>
  <span class="hl std">arr</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">aperm</span><span class="hl std">(arr,</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">3</span><span class="hl std">,</span> <span class="hl num">4</span><span class="hl std">,</span> <span class="hl num">5</span><span class="hl std">,</span> <span class="hl num">6</span><span class="hl std">))</span>
  <span class="hl kwd">dimnames</span><span class="hl std">(arr)</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">dimnames</span><span class="hl std">(x)</span>
  <span class="hl std">x</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">FLQuant</span><span class="hl std">(arr)</span>
<span class="hl std">}</span>

<span class="hl com"># # first the full dataset</span>
<span class="hl com"># lst &lt;- lapply(FLIndices(tun[[1]],tun[[2]],tun[[3]]),index)</span>
<span class="hl com"># inds &lt;- mcf(lst)</span>
<span class="hl com"># inds1 &lt;- lapply(inds,fun)</span>

<span class="hl com"># then only the selected ages</span>
<span class="hl std">lst</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">lapply</span><span class="hl std">(</span><span class="hl kwd">FLIndices</span><span class="hl std">(tun.sel[[</span><span class="hl num">1</span><span class="hl std">]], tun.sel[[</span><span class="hl num">2</span><span class="hl std">]], tun.sel[[</span><span class="hl num">3</span><span class="hl std">]], tun.sel[[</span><span class="hl num">4</span><span class="hl std">]], tun.sel[[</span><span class="hl num">5</span><span class="hl std">]]), index)</span>
<span class="hl std">inds</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">mcf</span><span class="hl std">(lst)</span>
<span class="hl std">inds2</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">lapply</span><span class="hl std">(inds, fun)</span>
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-20"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">akey</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwc">points</span> <span class="hl std">= F,</span> <span class="hl kwc">lines</span> <span class="hl std">= T,</span> <span class="hl kwc">columns</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">cex</span> <span class="hl std">=</span> <span class="hl num">0.8</span><span class="hl std">,</span> <span class="hl kwc">space</span> <span class="hl std">=</span> <span class="hl str">&quot;right&quot;</span><span class="hl std">)</span>
<span class="hl kwd">xyplot</span><span class="hl std">(data</span> <span class="hl opt">~</span> <span class="hl std">(year</span> <span class="hl opt">-</span> <span class="hl kwd">as.numeric</span><span class="hl std">(</span><span class="hl kwd">as.character</span><span class="hl std">(age)))</span> <span class="hl opt">|</span> <span class="hl std">qname,</span> <span class="hl kwc">groups</span> <span class="hl std">= age,</span> <span class="hl kwc">data</span> <span class="hl std">= inds2,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;b&quot;</span><span class="hl std">,</span> <span class="hl kwc">auto.key</span> <span class="hl std">= akey,</span> <span class="hl kwc">as.table</span> <span class="hl std">= T,</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Cohort&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;standardised CPUE&quot;</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-20-1.png" alt="plot of chunk unnamed-chunk-20" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;tun_consist2&quot;</span><span class="hl std">,</span> <span class="hl num">10.5</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-21"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">xyplot</span><span class="hl std">(data</span> <span class="hl opt">~</span> <span class="hl std">year</span> <span class="hl opt">|</span> <span class="hl kwd">factor</span><span class="hl std">(age),</span> <span class="hl kwc">groups</span> <span class="hl std">= qname,</span> <span class="hl kwc">data</span> <span class="hl std">= inds2,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;b&quot;</span><span class="hl std">,</span> <span class="hl kwc">auto.key</span> <span class="hl std">= akey,</span> <span class="hl kwc">as.table</span> <span class="hl std">= T,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;standardised CPUE&quot;</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-21-1.png" alt="plot of chunk unnamed-chunk-21" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;tun_consist3&quot;</span><span class="hl std">,</span> <span class="hl num">10</span><span class="hl std">,</span> <span class="hl num">5</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-22"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># a &lt;- plot(tun[[1]])</span>
<span class="hl std">b</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">plot</span><span class="hl std">(tun.sel[[</span><span class="hl num">1</span><span class="hl std">]])</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-22-1.png" alt="plot of chunk unnamed-chunk-22" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># grid.arrange(a,b,ncol=2)</span>
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-23"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># a &lt;- plot(tun[[2]])</span>
<span class="hl std">b</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">plot</span><span class="hl std">(tun.sel[[</span><span class="hl num">2</span><span class="hl std">]])</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-23-1.png" alt="plot of chunk unnamed-chunk-23" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># grid.arrange(a,b,ncol=2)</span>
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-24"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># a &lt;- plot(tun[[3]])</span>
<span class="hl std">b</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">plot</span><span class="hl std">(tun.sel[[</span><span class="hl num">3</span><span class="hl std">]])</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in x@.Data[i, j, k, l, m, n, drop = FALSE]: subscript out of bounds
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># grid.arrange(a,b,ncol=2)</span>
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-25"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># a &lt;- plot(tun[[4]])</span>
<span class="hl std">b</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">plot</span><span class="hl std">(tun.sel[[</span><span class="hl num">4</span><span class="hl std">]])</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-25-1.png" alt="plot of chunk unnamed-chunk-25" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># grid.arrange(a,b,ncol=2)</span>
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-26"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># a &lt;- plot(tun[[5]])</span>
<span class="hl std">b</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">plot</span><span class="hl std">(tun.sel[[</span><span class="hl num">5</span><span class="hl std">]])</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-26-1.png" alt="plot of chunk unnamed-chunk-26" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># grid.arrange(a,b,ncol=2)</span>
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-27"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">cc</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.data.frame</span><span class="hl std">(</span><span class="hl kwd">lapply</span><span class="hl std">(</span><span class="hl kwd">FLIndices</span><span class="hl std">(tun.sel[[</span><span class="hl num">1</span><span class="hl std">]], tun.sel[[</span><span class="hl num">2</span><span class="hl std">]], tun.sel[[</span><span class="hl num">3</span><span class="hl std">]], tun.sel[[</span><span class="hl num">4</span><span class="hl std">]], tun.sel[[</span><span class="hl num">5</span><span class="hl std">]]),</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">)</span> <span class="hl kwd">logcc</span><span class="hl std">(</span><span class="hl kwd">index</span><span class="hl std">(x))))</span>
<span class="hl kwd">xyplot</span><span class="hl std">(data</span> <span class="hl opt">~</span> <span class="hl std">age</span> <span class="hl opt">|</span> <span class="hl std">cname,</span> <span class="hl kwc">groups</span> <span class="hl std">= cohort,</span> <span class="hl kwc">data</span> <span class="hl std">= cc,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;b&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;log ratio&quot;</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-27-1.png" alt="plot of chunk unnamed-chunk-27" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">xyplot</span><span class="hl std">(data</span> <span class="hl opt">~</span> <span class="hl std">age</span> <span class="hl opt">|</span> <span class="hl std">cname,</span> <span class="hl kwc">groups</span> <span class="hl std">= cohort,</span> <span class="hl kwc">data</span> <span class="hl std">= cc,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;b&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;log ratio&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl num">3</span><span class="hl std">))</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-27-2.png" alt="plot of chunk unnamed-chunk-27" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;tun_logratio&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-28"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">tun.ind</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.data.frame</span><span class="hl std">(</span><span class="hl kwd">lapply</span><span class="hl std">(tun.sel, index))</span>
<span class="hl std">tun.ind</span><span class="hl opt">$</span><span class="hl std">yearclass</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.numeric</span><span class="hl std">(</span><span class="hl kwd">as.character</span><span class="hl std">(tun.ind</span><span class="hl opt">$</span><span class="hl std">year))</span> <span class="hl opt">-</span> <span class="hl kwd">as.numeric</span><span class="hl std">(</span><span class="hl kwd">as.character</span><span class="hl std">(tun.ind</span><span class="hl opt">$</span><span class="hl std">age))</span>
<span class="hl kwd">xyplot</span><span class="hl std">(</span><span class="hl kwd">log</span><span class="hl std">(data)</span> <span class="hl opt">~</span> <span class="hl std">year</span> <span class="hl opt">|</span> <span class="hl std">qname,</span> <span class="hl kwc">groups</span> <span class="hl std">= yearclass,</span> <span class="hl kwc">data</span> <span class="hl std">= tun.ind,</span> <span class="hl kwc">scales</span> <span class="hl std">=</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwc">y</span> <span class="hl std">=</span> <span class="hl str">&quot;free&quot;</span><span class="hl std">),</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;log indices&quot;</span><span class="hl std">,</span> <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-28-1.png" alt="plot of chunk unnamed-chunk-28" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;tun_cc&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-29"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">par</span><span class="hl std">(</span><span class="hl kwc">mfrow</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl num">3</span><span class="hl std">))</span>
<span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">5</span><span class="hl std">) {</span>
  <span class="hl std">range</span> <span class="hl kwb">&lt;-</span> <span class="hl std">tun.sel[[i]]</span><span class="hl opt">@</span><span class="hl kwc">range</span>
  <span class="hl std">time</span> <span class="hl kwb">&lt;-</span> <span class="hl std">range[</span><span class="hl num">4</span><span class="hl std">]</span><span class="hl opt">:</span><span class="hl std">range[</span><span class="hl num">5</span><span class="hl std">]</span> <span class="hl opt">+</span> <span class="hl kwd">mean</span><span class="hl std">(range[</span><span class="hl num">6</span><span class="hl opt">:</span><span class="hl num">7</span><span class="hl std">])</span>
  <span class="hl std">abund</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">apply</span><span class="hl std">(tun.sel[[i]]</span><span class="hl opt">@</span><span class="hl kwc">index</span><span class="hl std">,</span> <span class="hl num">2</span><span class="hl std">, sum,</span> <span class="hl kwc">na.rm</span> <span class="hl std">= T)</span>
  <span class="hl std">abund</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ifelse</span><span class="hl std">(abund</span> <span class="hl opt">==</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">, abund)</span>
  <span class="hl kwd">plot</span><span class="hl std">(time, abund,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;b&quot;</span><span class="hl std">,</span> <span class="hl kwc">xlim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1984</span><span class="hl std">,</span> <span class="hl num">2018</span><span class="hl std">),</span> <span class="hl kwc">ylim</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwd">max</span><span class="hl std">(abund,</span> <span class="hl kwc">na.rm</span> <span class="hl std">= T)),</span> <span class="hl kwc">main</span> <span class="hl std">= tun.sel[[i]]</span><span class="hl opt">@</span><span class="hl kwc">name</span><span class="hl std">,</span> <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Year&quot;</span><span class="hl std">,</span> <span class="hl kwc">ylab</span> <span class="hl std">=</span> <span class="hl str">&quot;Abundance index (all ages)&quot;</span><span class="hl std">)</span>
<span class="hl std">}</span>

<span class="hl kwd">SavePlot</span><span class="hl std">(</span><span class="hl str">&quot;indices&quot;</span><span class="hl std">,</span> <span class="hl num">8</span><span class="hl std">,</span> <span class="hl num">3.5</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## png 
##   2
</pre></div>
</div><div class="rimage center"><img src="figure/data-exploration-Rhtmlunnamed-chunk-29-1.png" alt="plot of chunk unnamed-chunk-29" class="plot" /></div></div>

  <p>The R session information (including the OS info, R version and all
    packages used):</p>

<div class="chunk" id="session-info"><div class="rcode"><div class="source"><pre class="knitr r">    <span class="hl kwd">sessionInfo</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## R version 4.1.2 (2021-11-01)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 19044)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_United Kingdom.1252  LC_CTYPE=English_United Kingdom.1252   
## [3] LC_MONETARY=English_United Kingdom.1252 LC_NUMERIC=C                           
## [5] LC_TIME=English_United Kingdom.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] ggridges_0.5.4     tidyr_1.3.0        dplyr_1.1.2        gridExtra_2.3     
##  [5] FLEDA_2.5.2        FLCore_2.6.19.9002 iterators_1.0.14   lattice_0.21-8    
##  [9] knitr_1.42         icesTAF_4.2.0     
## 
## loaded via a namespace (and not attached):
##  [1] nlme_3.1-153        fs_1.5.2            usethis_2.1.6       devtools_2.4.5     
##  [5] RColorBrewer_1.1-3  data.tree_1.0.0     numDeriv_2016.8-1.1 tools_4.1.2        
##  [9] profvis_0.3.7       utf8_1.2.2          R6_2.5.1            mgcv_1.8-42        
## [13] colorspace_2.0-3    urlchecker_1.0.1    tidyselect_1.2.0    prettyunits_1.1.1  
## [17] processx_3.8.1      TAF_4.2.1           compiler_4.1.2      pspline_1.0-19     
## [21] cli_3.6.1           xml2_1.3.3          scales_1.2.1        mvtnorm_1.1-3      
## [25] callr_3.7.3         stringr_1.5.0       digest_0.6.29       jpeg_0.1-10        
## [29] triangle_1.0        pkgconfig_2.0.3     htmltools_0.5.5     sessioninfo_1.2.2  
## [33] fastmap_1.1.0       stabledist_0.7-1    ADGofTest_0.3       highr_0.9          
## [37] htmlwidgets_1.6.2   rlang_1.1.0         rstudioapi_0.14     shiny_1.7.4        
## [41] generics_0.1.3      magrittr_2.0.3      interp_1.1-4        Matrix_1.5-4       
## [45] Rcpp_1.0.10         munsell_0.5.0       fansi_1.0.4         lifecycle_1.0.3    
## [49] stringi_1.7.12      MASS_7.3-58.3       pkgbuild_1.3.1      grid_4.1.2         
## [53] promises_1.2.0.1    crayon_1.5.2        miniUI_0.1.1.1      deldir_1.0-6       
## [57] splines_4.1.2       ps_1.7.5            pillar_1.9.0        stats4_4.1.2       
## [61] pkgload_1.3.2       glue_1.6.2          evaluate_0.15       latticeExtra_0.6-30
## [65] remotes_2.4.2       png_0.1-8           vctrs_0.6.1         httpuv_1.6.9       
## [69] gtable_0.3.0        purrr_1.0.1         assertthat_0.2.1    cachem_1.0.6       
## [73] ggplot2_3.4.2       FLa4a_1.8.3         xfun_0.39           mime_0.12          
## [77] xtable_1.8-4        coda_0.19-4         roxygen2_7.2.3      later_1.3.0        
## [81] pcaPP_2.0-3         gsl_2.1-8           tibble_3.2.1        copula_1.1-2       
## [85] memoise_2.0.1       ellipsis_0.3.2
</pre></div>
<div class="source"><pre class="knitr r">    <span class="hl kwd">Sys.time</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;2023-05-19 13:09:08 CEST&quot;
</pre></div>
</div></div>


</body>
</html>
